<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fashion MNIST VAE Explorer</title>
    <style>
        :root {
            --primary-color: #6200ea;
            --primary-light: #9d46ff;
            --primary-dark: #0a00b6;
            --secondary-color: #03dac6;
            --text-on-primary: #ffffff;
            --background: #f5f5f7;
            --card-bg: #ffffff;
            --text-color: #333333;
            --border-radius: 8px;
            --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background-color: var(--background);
            margin: 0;
            padding: 0;
        }

        header {
            background-color: var(--primary-color);
            color: var(--text-on-primary);
            padding: 1.5rem 0;
            text-align: center;
        }

        h1, h2, h3, h4 {
            margin-top: 0;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .card {
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 25px;
            margin-bottom: 30px;
        }

        .card h2 {
            color: var(--primary-color);
            border-bottom: 2px solid var(--primary-light);
            padding-bottom: 10px;
            margin-bottom: 20px;
        }

        .tab-container {
            margin-bottom: 20px;
        }

        .tab-buttons {
            display: flex;
            border-bottom: 2px solid var(--primary-color);
            margin-bottom: 20px;
        }

        .tab-button {
            padding: 10px 20px;
            cursor: pointer;
            background-color: #f0f0f0;
            border: none;
            margin-right: 5px;
            border-radius: var(--border-radius) var(--border-radius) 0 0;
            transition: var(--transition);
        }

        .tab-button.active {
            background-color: var(--primary-color);
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .two-column {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 20px;
        }

        .column {
            flex: 1;
            min-width: 300px;
        }

        /* Controls styles */
        .control-panel {
            background-color: #f8f8f8;
            padding: 15px;
            border-radius: var(--border-radius);
            margin-bottom: 20px;
        }

        .slider-container {
            margin-bottom: 15px;
        }

        .slider-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }

        input[type="range"] {
            width: 100%;
            margin: 10px 0;
        }

        .select-container {
            margin-bottom: 15px;
        }

        select {
            width: 100%;
            padding: 8px;
            border-radius: var(--border-radius);
            border: 1px solid #ddd;
        }

        button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
        }

        button:hover {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
        }

        /* Visualization styles */
        .visualization-container {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        #latent-space-container {
            width: 100%;
            height: 350px;
            background-color: #f0f0f0;
            border-radius: var(--border-radius);
            position: relative;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .latent-point {
            position: absolute;
            width: 12px;
            height: 12px;
            background-color: var(--primary-color);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            cursor: pointer;
            transition: var(--transition);
        }

        .latent-point:hover, .latent-point.selected {
            width: 16px;
            height: 16px;
            background-color: var(--secondary-color);
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
        }

        .latent-label {
            position: absolute;
            font-size: 12px;
            background-color: rgba(255, 255, 255, 0.8);
            padding: 2px 5px;
            border-radius: 3px;
            white-space: nowrap;
            transform: translate(-50%, 10px);
        }

        #interpolation-container {
            width: 100%;
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 20px;
        }

        .fashion-item {
            width: 60px;
            height: 60px;
            background-color: #f0f0f0;
            border-radius: var(--border-radius);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        .fashion-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .fashion-item.selected {
            border: 2px solid var(--primary-color);
        }

        /* Explanation collapsible */
        .collapsible {
            background-color: #f0f0f0;
            cursor: pointer;
            padding: 18px;
            width: 100%;
            border: none;
            text-align: left;
            outline: none;
            font-size: 16px;
            border-radius: var(--border-radius);
            margin-bottom: 10px;
            position: relative;
        }

        .collapsible:after {
            content: '\002B';
            color: var(--primary-color);
            font-weight: bold;
            float: right;
        }

        .collapsible.active:after {
            content: "\2212";
        }

        .collapsible-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.2s ease-out;
            background-color: white;
            border-radius: 0 0 var(--border-radius) var(--border-radius);
        }

        .collapsible-content-inner {
            padding: 0 18px;
        }

        /* Code display */
        .code-block {
            background-color: #1e1e1e;
            color: #d4d4d4;
            padding: 15px;
            border-radius: var(--border-radius);
            overflow-x: auto;
            font-family: 'Consolas', 'Courier New', monospace;
            margin: 15px 0;
        }

        /* Responsive design */
        @media (max-width: 768px) {
            .two-column {
                flex-direction: column;
            }
            
            .column {
                min-width: 100%;
            }
        }

        /* Loading spinner */
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            width: 30px;
            height: 30px;
            border-radius: 50%;
            border-left-color: var(--primary-color);
            animation: spin 1s linear infinite;
            margin: 20px auto;
            display: none;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>Fashion MNIST VAE Explorer</h1>
            <p>Interactive demonstration of Variational Autoencoder latent space for Fashion MNIST dataset</p>
        </div>
    </header>

    <div class="container">
        <!-- Main content -->
        <div class="card">
            <h2>Latent Space Exploration</h2>
            
            <div class="tab-container">
                <div class="tab-buttons">
                    <button class="tab-button active" data-tab="latent-space">Latent Space</button>
                    <button class="tab-button" data-tab="interpolation">Interpolation</button>
                    <button class="tab-button" data-tab="dimension-traverse">Dimension Traversal</button>
                </div>
                
                <!-- Latent Space Tab -->
                <div class="tab-content active" id="latent-space">
                    <div class="two-column">
                        <div class="column">
                            <div class="control-panel">
                                <h3>Latent Space Controls</h3>
                                <div class="slider-container">
                                    <label>Latent Dimension Weights:</label>
                                    <div class="slider-label">
                                        <span>Dimension 1:</span>
                                        <span id="dim1-value">1.0</span>
                                    </div>
                                    <input type="range" id="dim1-slider" min="0" max="2" step="0.1" value="1.0">
                                    
                                    <div class="slider-label">
                                        <span>Dimension 2:</span>
                                        <span id="dim2-value">1.0</span>
                                    </div>
                                    <input type="range" id="dim2-slider" min="0" max="2" step="0.1" value="1.0">
                                </div>
                                
                                <div class="slider-container">
                                    <div class="slider-label">
                                        <span>Clustering Factor:</span>
                                        <span id="cluster-value">1.0</span>
                                    </div>
                                    <input type="range" id="cluster-slider" min="0.1" max="2" step="0.1" value="1.0">
                                </div>
                                
                                <button id="reset-view-btn">Reset View</button>
                            </div>
                            
                            <div>
                                <button class="collapsible">Understanding the Visualization</button>
                                <div class="collapsible-content">
                                    <div class="collapsible-content-inner">
                                        <p>This visualization shows a simulated 2D projection of the VAE's latent space for Fashion MNIST items. Each point represents an encoded fashion item, with similar items clustering together.</p>
                                        <p>In a real VAE, the latent space would be high-dimensional (we used 64 dimensions in the code), but here we're showing a simplified 2D view.</p>
                                        <ul>
                                            <li>Click on a point to see the corresponding fashion item</li>
                                            <li>Adjust the dimension weights to emphasize different features</li>
                                            <li>The clustering factor controls how tightly items of the same class group together</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="column">
                            <div class="visualization-container">
                                <div id="latent-space-container">
                                    <!-- Points will be added here dynamically -->
                                </div>
                                <div id="selected-item-container">
                                    <h4>Selected Item: <span id="selected-item-label">None</span></h4>
                                    <div class="fashion-item" id="selected-item">
                                        <!-- Selected item will be shown here -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Interpolation Tab -->
                <div class="tab-content" id="interpolation">
                    <div class="two-column">
                        <div class="column">
                            <div class="control-panel">
                                <h3>Interpolation Controls</h3>
                                <div class="select-container">
                                    <label for="start-item">Starting Item:</label>
                                    <select id="start-item">
                                        <option value="0">T-shirt/Top</option>
                                        <option value="1">Trouser</option>
                                        <option value="2">Pullover</option>
                                        <option value="3">Dress</option>
                                        <option value="4">Coat</option>
                                        <option value="5">Sandal</option>
                                        <option value="6">Shirt</option>
                                        <option value="7">Sneaker</option>
                                        <option value="8">Bag</option>
                                        <option value="9">Ankle Boot</option>
                                    </select>
                                </div>
                                
                                <div class="select-container">
                                    <label for="end-item">Ending Item:</label>
                                    <select id="end-item">
                                        <option value="0">T-shirt/Top</option>
                                        <option value="1">Trouser</option>
                                        <option value="2">Pullover</option>
                                        <option value="3">Dress</option>
                                        <option value="4">Coat</option>
                                        <option value="5">Sandal</option>
                                        <option value="6">Shirt</option>
                                        <option value="7" selected>Sneaker</option>
                                        <option value="8">Bag</option>
                                        <option value="9">Ankle Boot</option>
                                    </select>
                                </div>
                                
                                <div class="slider-container">
                                    <div class="slider-label">
                                        <span>Number of Steps:</span>
                                        <span id="steps-value">10</span>
                                    </div>
                                    <input type="range" id="steps-slider" min="3" max="15" step="1" value="10">
                                </div>
                                
                                <button id="generate-interpolation-btn">Generate Interpolation</button>
                                <div class="spinner" id="interpolation-spinner"></div>
                            </div>
                            
                            <div>
                                <button class="collapsible">How Latent Space Interpolation Works</button>
                                <div class="collapsible-content">
                                    <div class="collapsible-content-inner">
                                        <p>Interpolation in the latent space is one of the most powerful capabilities of VAEs. Here's how it works:</p>
                                        <ol>
                                            <li>Two different items are encoded into the latent space, creating two latent vectors (z₁ and z₂)</li>
                                            <li>We create new points along the line between these vectors using the formula: z = (1-t)·z₁ + t·z₂, where t ranges from 0 to 1</li>
                                            <li>Each interpolated point is then decoded back to the image space</li>
                                            <li>The result is a smooth transition between the two items</li>
                                        </ol>
                                        <p>This demonstrates how the VAE has learned a continuous latent space where similar concepts are close together, enabling smooth transformations between different fashion items.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="column">
                            <div class="visualization-container">
                                <h3>Interpolation Result</h3>
                                <div id="interpolation-container">
                                    <!-- Interpolation will be shown here -->
                                    <p>Select items and click "Generate Interpolation" to see results</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Dimension Traversal Tab -->
                <div class="tab-content" id="dimension-traverse">
                    <div class="two-column">
                        <div class="column">
                            <div class="control-panel">
                                <h3>Dimension Traversal Controls</h3>
                                <div class="select-container">
                                    <label for="base-item">Base Item:</label>
                                    <select id="base-item">
                                        <option value="0">T-shirt/Top</option>
                                        <option value="1">Trouser</option>
                                        <option value="2">Pullover</option>
                                        <option value="3">Dress</option>
                                        <option value="4">Coat</option>
                                        <option value="5">Sandal</option>
                                        <option value="6">Shirt</option>
                                        <option value="7">Sneaker</option>
                                        <option value="8">Bag</option>
                                        <option value="9">Ankle Boot</option>
                                    </select>
                                </div>
                                
                                <div class="select-container">
                                    <label for="dimension-select">Dimension to Traverse:</label>
                                    <select id="dimension-select">
                                        <option value="0">Dimension 1</option>
                                        <option value="1">Dimension 2</option>
                                        <option value="2">Dimension 3</option>
                                        <option value="3">Dimension 4</option>
                                    </select>
                                </div>
                                
                                <div class="slider-container">
                                    <div class="slider-label">
                                        <span>Range:</span>
                                        <span id="range-value">3.0</span>
                                    </div>
                                    <input type="range" id="range-slider" min="1" max="5" step="0.5" value="3.0">
                                </div>
                                
                                <button id="generate-traversal-btn">Generate Traversal</button>
                                <div class="spinner" id="traversal-spinner"></div>
                            </div>
                            
                            <div>
                                <button class="collapsible">Understanding Latent Dimension Traversal</button>
                                <div class="collapsible-content">
                                    <div class="collapsible-content-inner">
                                        <p>Latent dimension traversal reveals what features each dimension in the latent space has learned to represent:</p>
                                        <ul>
                                            <li>We start with a fixed point in latent space (the encoded base item)</li>
                                            <li>We vary just one dimension while keeping all others constant</li>
                                            <li>By observing how the generated image changes, we can understand what that dimension controls</li>
                                        </ul>
                                        <p>For example, one dimension might control whether an item has sleeves, while another might represent color or texture. This visualization helps us understand how the VAE has learned to disentangle different features in its latent representation.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="column">
                            <div class="visualization-container">
                                <h3>Dimension Traversal Result</h3>
                                <div id="traversal-container">
                                    <!-- Traversal will be shown here -->
                                    <p>Select a base item and dimension, then click "Generate Traversal" to see results</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- VAE Explanation Card -->
        <div class="card">
            <h2>Understanding Variational Autoencoders (VAEs)</h2>
            
            <div class="two-column">
                <div class="column">
                    <h3>What is a VAE?</h3>
                    <p>A Variational Autoencoder (VAE) is a type of generative model that learns to encode data into a compact latent representation and then decode it back to the original data space. Unlike regular autoencoders, VAEs encode inputs as probability distributions in the latent space, creating a continuous and structured representation.</p>
                    
                    <h3>Key Components:</h3>
                    <ul>
                        <li><strong>Encoder Network:</strong> Maps input data to parameters (μ and σ) of a probability distribution in latent space</li>
                        <li><strong>Latent Space:</strong> A lower-dimensional space where similar inputs are mapped to nearby points</li>
                        <li><strong>Decoder Network:</strong> Reconstructs data from points in the latent space</li>
                        <li><strong>Reparameterization Trick:</strong> Enables backpropagation through the sampling process</li>
                    </ul>
                    
                    <h3>Loss Function:</h3>
                    <p>VAEs are trained with two objectives:</p>
                    <ol>
                        <li><strong>Reconstruction Loss:</strong> Ensures the model can accurately reconstruct inputs</li>
                        <li><strong>KL Divergence:</strong> Encourages the latent space to approximate a standard normal distribution, enabling smooth interpolation and generation</li>
                    </ol>
                </div>
                
                <div class="column">
                    <h3>Why VAEs are Powerful:</h3>
                    <ul>
                        <li><strong>Structured Latent Space:</strong> Similar data points are mapped close together, enabling meaningful interpolation</li>
                        <li><strong>Generative Capabilities:</strong> Can generate new, realistic samples by sampling from the latent space</li>
                        <li><strong>Disentangled Representations:</strong> Different dimensions can learn to represent different features</li>
                        <li><strong>Probabilistic Framework:</strong> Models uncertainty and variability in data</li>
                    </ul>
                    
                    <h3>Applications:</h3>
                    <ul>
                        <li><strong>Image Generation:</strong> Creating new, realistic images</li>
                        <li><strong>Data Compression:</strong> Representing high-dimensional data in a compact form</li>
                        <li><strong>Anomaly Detection:</strong> Identifying unusual patterns in data</li>
                        <li><strong>Feature Learning:</strong> Discovering meaningful features for downstream tasks</li>
                        <li><strong>Style Transfer:</strong> Transferring characteristics between different examples</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Fashion MNIST class names
        const fashionClasses = [
            'T-shirt/Top', 'Trouser', 'Pullover', 'Dress', 'Coat',
            'Sandal', 'Shirt', 'Sneaker', 'Bag', 'Ankle Boot'
        ];
        
        // Load the pre-generated data
        async function loadPreGeneratedData() {
            try {
                const classExamples = await fetch('./github_pages_assets/class_examples.json').then(res => res.json());
                const interpolationData = await fetch('./github_pages_assets/interpolation_data.json').then(res => res.json());
                const traversalData = await fetch('./github_pages_assets/traversal_data.json').then(res => res.json());
                
                return { classExamples, interpolationData, traversalData };
            } catch (error) {
                console.error('Error loading pre-generated data:', error);
                return null;
            }
        }
        
        // Store the data globally once loaded
        let preGeneratedData = null;
        
        // Helper function to get class name
        function getFashionClassName(classIdx) {
            return fashionClasses[classIdx];
        }
        
        // Tab switching functionality
        document.querySelectorAll('.tab-button').forEach(button => {
            button.addEventListener('click', () => {
                // Remove active class from all buttons and contents
                document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
                
                // Add active class to clicked button
                button.classList.add('active');
                
                // Show corresponding content
                const tabId = button.getAttribute('data-tab');
                document.getElementById(tabId).classList.add('active');
            });
        });
        
        // Collapsible functionality
        document.querySelectorAll('.collapsible').forEach(coll => {
            coll.addEventListener('click', function() {
                this.classList.toggle('active');
                const content = this.nextElementSibling;
                if (content.style.maxHeight) {
                    content.style.maxHeight = null;
                } else {
                    content.style.maxHeight = content.scrollHeight + 'px';
                }
            });
        });
        
        // Latent Space Visualization
        function initializeLatentSpace() {
            const container = document.getElementById('latent-space-container');
            container.innerHTML = '';
            
            // Class centers (pre-computed to create realistic clusters)
            const classCenters = [
                {x: 30, y: 25},  // T-shirt
                {x: 70, y: 25},  // Trouser
                {x: 50, y: 15},  // Pullover
                {x: 40, y: 40},  // Dress
                {x: 60, y: 35},  // Coat
                {x: 25, y: 70},  // Sandal
                {x: 45, y: 60},  // Shirt
                {x: 65, y: 75},  // Sneaker
                {x: 75, y: 50},  // Bag
                {x: 20, y: 50}   // Ankle Boot
            ];
            
            // Get control values
            const clusterFactor = parseFloat(document.getElementById('cluster-slider').value);
            const dim1Weight = parseFloat(document.getElementById('dim1-slider').value);
            const dim2Weight = parseFloat(document.getElementById('dim2-slider').value);
            
            // Generate multiple points per class with gaussian distribution
            for (let classIdx = 0; classIdx < 10; classIdx++) {
                const center = classCenters[classIdx];
                
                // Create 5 instances per class
                for (let i = 0; i < 5; i++) {
                    const point = document.createElement('div');
                    point.classList.add('latent-point');
                    
                    // Apply dimension weights and clustering factor
                    const variance = 10 / clusterFactor;
                    let x = center.x + gaussianRandom(0, variance) * dim1Weight;
                    let y = center.y + gaussianRandom(0, variance) * dim2Weight;
                    
                    // Ensure within bounds
                    x = Math.max(5, Math.min(95, x));
                    y = Math.max(5, Math.min(95, y));
                    
                    point.style.left = `${x}%`;
                    point.style.top = `${y}%`;
                    point.dataset.class = classIdx;
                    point.dataset.instance = i;
                    
                    // Add click event listener
                    point.addEventListener('click', () => {
                        displaySelectedItem(classIdx, i);
                        
                        // Remove previous selection
                        document.querySelectorAll('.latent-point.selected').forEach(p => {
                            p.classList.remove('selected');
                        });
                        
                        // Mark this point as selected
                        point.classList.add('selected');
                    });
                    
                    container.appendChild(point);
                }
                
                // Add class label at the center
                const label = document.createElement('div');
                label.classList.add('latent-label');
                label.textContent = getFashionClassName(classIdx);
                label.style.left = `${center.x}%`;
                label.style.top = `${center.y}%`;
                container.appendChild(label);
            }
        }
        
        // Display selected fashion item
        function displaySelectedItem(classIdx, instanceIdx) {
            const container = document.getElementById('selected-item');
            const label = document.getElementById('selected-item-label');
            
            // Update label
            label.textContent = getFashionClassName(classIdx);
            
            // Check if we have pre-generated data
            if (preGeneratedData && preGeneratedData.classExamples[classIdx]) {
                const imgPath = preGeneratedData.classExamples[classIdx];
                
                // Create image element
                container.innerHTML = '';
                const img = document.createElement('img');
                img.src = imgPath;
                img.style.width = '100%';
                img.style.height = '100%';
                container.appendChild(img);
            } else {
                // Fallback to colored block
                container.innerHTML = '';
                const block = document.createElement('div');
                block.style.width = '100%';
                block.style.height = '100%';
                block.style.backgroundColor = getColorForClass(classIdx);
                block.textContent = classIdx;
                block.style.display = 'flex';
                block.style.alignItems = 'center';
                block.style.justifyContent = 'center';
                block.style.color = 'white';
                block.style.fontWeight = 'bold';
                
                container.appendChild(block);
            }
        }
        
        // Get color for fashion class (for visualization)
        function getColorForClass(classIdx) {
            const colors = [
                '#3498db', // T-shirt/Top - blue
                '#2ecc71', // Trouser - green
                '#9b59b6', // Pullover - purple
                '#e74c3c', // Dress - red
                '#34495e', // Coat - dark blue
                '#f39c12', // Sandal - orange
                '#1abc9c', // Shirt - teal
                '#d35400', // Sneaker - dark orange
                '#7f8c8d', // Bag - gray
                '#2c3e50'  // Ankle Boot - very dark blue
            ];
            
            return colors[classIdx];
        }
        
        // Helper function for gaussian random numbers (Box-Muller transform)
        function gaussianRandom(mean = 0, stdev = 1) {
            const u = 1 - Math.random();
            const v = Math.random();
            const z = Math.sqrt(-2.0 * Math.log(u)) * Math.cos(2.0 * Math.PI * v);
            return z * stdev + mean;
        }
        
        // Initialize and bind sliders
        function initSliders() {
            const dim1Slider = document.getElementById('dim1-slider');
            const dim1Value = document.getElementById('dim1-value');
            dim1Slider.addEventListener('input', () => {
                dim1Value.textContent = dim1Slider.value;
                initializeLatentSpace();
            });
            
            const dim2Slider = document.getElementById('dim2-slider');
            const dim2Value = document.getElementById('dim2-value');
            dim2Slider.addEventListener('input', () => {
                dim2Value.textContent = dim2Slider.value;
                initializeLatentSpace();
            });
            
            const clusterSlider = document.getElementById('cluster-slider');
            const clusterValue = document.getElementById('cluster-value');
            clusterSlider.addEventListener('input', () => {
                clusterValue.textContent = clusterSlider.value;
                initializeLatentSpace();
            });
            
            const stepsSlider = document.getElementById('steps-slider');
            const stepsValue = document.getElementById('steps-value');
            stepsSlider.addEventListener('input', () => {
                stepsValue.textContent = stepsSlider.value;
            });
            
            const rangeSlider = document.getElementById('range-slider');
            const rangeValue = document.getElementById('range-value');
            rangeSlider.addEventListener('input', () => {
                rangeValue.textContent = rangeSlider.value;
            });
        }
        
        // Reset view button
        document.getElementById('reset-view-btn').addEventListener('click', () => {
            document.getElementById('dim1-slider').value = 1.0;
            document.getElementById('dim1-value').textContent = 1.0;
            document.getElementById('dim2-slider').value = 1.0;
            document.getElementById('dim2-value').textContent = 1.0;
            document.getElementById('cluster-slider').value = 1.0;
            document.getElementById('cluster-value').textContent = 1.0;
            initializeLatentSpace();
        });
        
        // Generate interpolation
        document.getElementById('generate-interpolation-btn').addEventListener('click', () => {
            const startClassIdx = parseInt(document.getElementById('start-item').value);
            const endClassIdx = parseInt(document.getElementById('end-item').value);
            const steps = parseInt(document.getElementById('steps-slider').value);
            
            // Show loading spinner
            document.getElementById('interpolation-spinner').style.display = 'block';
            
            // Clear previous
            const container = document.getElementById('interpolation-container');
            container.innerHTML = '';
            
            // Use pre-generated data if available
            if (preGeneratedData) {
                const key = `${startClassIdx}_to_${endClassIdx}`;
                const images = preGeneratedData.interpolationData[key];
                
                if (images) {
                    // Display the pre-generated images
                    images.forEach((imagePath, i) => {
                        const item = document.createElement('div');
                        item.classList.add('fashion-item');
                        
                        // For first and last items, add 'selected' class
                        if (i === 0 || i === images.length - 1) {
                            item.classList.add('selected');
                        }
                        
                        // Calculate interpolation factor
                        const t = i / (images.length - 1);
                        
                        // Create image element
                        const img = document.createElement('img');
                        img.src = imagePath;
                        img.style.width = '100%';
                        img.style.height = '100%';
                        
                        item.appendChild(img);
                        
                        // Add step label
                        const label = document.createElement('div');
                        label.style.position = 'absolute';
                        label.style.bottom = '-20px';
                        label.style.left = '0';
                        label.style.right = '0';
                        label.style.textAlign = 'center';
                        label.style.fontSize = '12px';
                        label.textContent = `t=${t.toFixed(1)}`;
                        
                        item.appendChild(label);
                        container.appendChild(item);
                    });
                    
                    // Add explanation
                    const explanation = document.createElement('p');
                    explanation.style.width = '100%';
                    explanation.style.marginTop = '30px';
                    explanation.innerHTML = `
                        <strong>Interpolation:</strong> ${getFashionClassName(startClassIdx)} → ${getFashionClassName(endClassIdx)}<br>
                        <small>This shows the gradual transformation between items as we move through latent space.</small>
                    `;
                    
                    container.appendChild(explanation);
                    document.getElementById('interpolation-spinner').style.display = 'none';
                } else {
                    // Fall back to simulation
                    simulateInterpolation(startClassIdx, endClassIdx, steps);
                    document.getElementById('interpolation-spinner').style.display = 'none';
                }
            } else {
                // Fall back to simulation
                simulateInterpolation(startClassIdx, endClassIdx, steps);
                document.getElementById('interpolation-spinner').style.display = 'none';
            }
        });
        
        // Simulate interpolation for demo
        function simulateInterpolation(startClassIdx, endClassIdx, steps) {
            const container = document.getElementById('interpolation-container');
            
            // Create interpolation items
            for (let i = 0; i < steps; i++) {
                const item = document.createElement('div');
                item.classList.add('fashion-item');
                
                // For first and last items, add 'selected' class
                if (i === 0 || i === steps - 1) {
                    item.classList.add('selected');
                }
                
                // Calculate interpolation factor
                const t = i / (steps - 1);
                
                // Create color blend for visualization
                const startColor = hexToRgb(getColorForClass(startClassIdx));
                const endColor = hexToRgb(getColorForClass(endClassIdx));
                
                const r = Math.round((1 - t) * startColor.r + t * endColor.r);
                const g = Math.round((1 - t) * startColor.g + t * endColor.g);
                const b = Math.round((1 - t) * startColor.b + t * endColor.b);
                
                const interpolatedColor = `rgb(${r}, ${g}, ${b})`;
                
                // Create inner content
                const inner = document.createElement('div');
                inner.style.width = '100%';
                inner.style.height = '100%';
                inner.style.backgroundColor = interpolatedColor;
                inner.style.display = 'flex';
                inner.style.alignItems = 'center';
                inner.style.justifyContent = 'center';
                inner.style.color = 'white';
                inner.style.fontWeight = 'bold';
                
                // Add label only for start and end
                if (i === 0) {
                    inner.textContent = startClassIdx;
                } else if (i === steps - 1) {
                    inner.textContent = endClassIdx;
                }
                
                item.appendChild(inner);
                
                // Add step label
                const label = document.createElement('div');
                label.style.position = 'absolute';
                label.style.bottom = '-20px';
                label.style.left = '0';
                label.style.right = '0';
                label.style.textAlign = 'center';
                label.style.fontSize = '12px';
                label.textContent = `t=${t.toFixed(1)}`;
                
                item.appendChild(label);
                container.appendChild(item);
            }
            
            // Add explanation
            const explanation = document.createElement('p');
            explanation.style.width = '100%';
            explanation.style.marginTop = '30px';
            explanation.innerHTML = `
                <strong>Interpolation:</strong> ${getFashionClassName(startClassIdx)} → ${getFashionClassName(endClassIdx)}<br>
                <small>This shows the gradual transformation between items as we move through latent space.</small>
            `;
            
            container.appendChild(explanation);
        }
        
        // Generate traversal
        document.getElementById('generate-traversal-btn').addEventListener('click', () => {
            const baseClassIdx = parseInt(document.getElementById('base-item').value);
            const dimensionIdx = parseInt(document.getElementById('dimension-select').value);
            const range = parseFloat(document.getElementById('range-slider').value);
            
            // Show loading spinner
            document.getElementById('traversal-spinner').style.display = 'block';
            
            // Clear previous
            const container = document.getElementById('traversal-container');
            container.innerHTML = '';
            
            // Use pre-generated data if available
            if (preGeneratedData && preGeneratedData.traversalData[baseClassIdx] && preGeneratedData.traversalData[baseClassIdx][dimensionIdx]) {
                const images = preGeneratedData.traversalData[baseClassIdx][dimensionIdx];
                
                // Create row
                const row = document.createElement('div');
                row.style.display = 'flex';
                row.style.justifyContent = 'center';
                row.style.gap = '10px';
                row.style.marginBottom = '20px';
                
                // Display the pre-generated images
                images.forEach((imagePath, i) => {
                    const item = document.createElement('div');
                    item.classList.add('fashion-item');
                    
                    // Calculate traversal factor
                    const steps = images.length;
                    const t = -range + (i / (steps - 1)) * (2 * range);
                    
                    // Create image element
                    const img = document.createElement('img');
                    img.src = imagePath;
                    img.style.width = '100%';
                    img.style.height = '100%';
                    
                    item.appendChild(img);
                    
                    // Add traversal value label
                    const label = document.createElement('div');
                    label.style.position = 'absolute';
                    label.style.bottom = '-20px';
                    label.style.left = '0';
                    label.style.right = '0';
                    label.style.textAlign = 'center';
                    label.style.fontSize = '12px';
                    label.textContent = t.toFixed(1);
                    
                    item.appendChild(label);
                    row.appendChild(item);
                });
                
                container.appendChild(row);
                
                // Add explanation
                const explanation = document.createElement('div');
                explanation.style.marginTop = '30px';
                explanation.innerHTML = `
                    <p><strong>Dimension ${dimensionIdx + 1} Traversal</strong> for ${getFashionClassName(baseClassIdx)}</p>
                    <p>This visualization shows how varying a single dimension in the latent space affects the generated output. Each dimension often captures a specific feature like shape, style, or texture.</p>
                    <p><small>The middle item (0.0) represents the original encoding, while negative and positive values show how the output changes when moving along this dimension.</small></p>
                `;
                
                container.appendChild(explanation);
                document.getElementById('traversal-spinner').style.display = 'none';
            } else {
                // Fall back to simulation
                simulateTraversal(baseClassIdx, dimensionIdx, range);
                document.getElementById('traversal-spinner').style.display = 'none';
            }
        });
        
        // Simulate dimension traversal for demo
        function simulateTraversal(baseClassIdx, dimensionIdx, range) {
            const container = document.getElementById('traversal-container');
            const steps = 7; // Fixed number of steps for traversal
            
            // Create row
            const row = document.createElement('div');
            row.style.display = 'flex';
            row.style.justifyContent = 'center';
            row.style.gap = '10px';
            row.style.marginBottom = '20px';
            
            // Create traversal items
            for (let i = 0; i < steps; i++) {
                const item = document.createElement('div');
                item.classList.add('fashion-item');
                
                // Calculate traversal factor
                const t = -range + (i / (steps - 1)) * (2 * range);
                
                // Base color
                const baseColor = hexToRgb(getColorForClass(baseClassIdx));
                
                // Modify color based on dimension and traversal factor
                let r = baseColor.r;
                let g = baseColor.g;
                let b = baseColor.b;
                
                // Different effects for different dimensions
                switch(dimensionIdx) {
                    case 0: // Dimension 1 - modify red
                        r = Math.min(255, Math.max(0, r + t * 50));
                        break;
                    case 1: // Dimension 2 - modify green
                        g = Math.min(255, Math.max(0, g + t * 50));
                        break;
                    case 2: // Dimension 3 - modify blue
                        b = Math.min(255, Math.max(0, b + t * 50));
                        break;
                    case 3: // Dimension 4 - modify brightness
                        r = Math.min(255, Math.max(0, r + t * 30));
                        g = Math.min(255, Math.max(0, g + t * 30));
                        b = Math.min(255, Math.max(0, b + t * 30));
                        break;
                }
                
                const traversedColor = `rgb(${Math.round(r)}, ${Math.round(g)}, ${Math.round(b)})`;
                
                // Create inner content
                const inner = document.createElement('div');
                inner.style.width = '100%';
                inner.style.height = '100%';
                inner.style.backgroundColor = traversedColor;
                inner.style.display = 'flex';
                inner.style.alignItems = 'center';
                inner.style.justifyContent = 'center';
                inner.style.color = 'white';
                inner.style.fontWeight = 'bold';
                
                // Center item has class label
                if (i === Math.floor(steps/2)) {
                    inner.textContent = baseClassIdx;
                }
                
                item.appendChild(inner);
                
                // Add traversal value label
                const label = document.createElement('div');
                label.style.position = 'absolute';
                label.style.bottom = '-20px';
                label.style.left = '0';
                label.style.right = '0';
                label.style.textAlign = 'center';
                label.style.fontSize = '12px';
                label.textContent = t.toFixed(1);
                
                item.appendChild(label);
                row.appendChild(item);
            }
            
            container.appendChild(row);
            
            // Add explanation
            const explanation = document.createElement('div');
            explanation.style.marginTop = '30px';
            explanation.innerHTML = `
                <p><strong>Dimension ${dimensionIdx + 1} Traversal</strong> for ${getFashionClassName(baseClassIdx)}</p>
                <p>This visualization shows how varying a single dimension in the latent space affects the generated output. Each dimension often captures a specific feature like shape, style, or texture.</p>
                <p><small>The middle item (0.0) represents the original encoding, while negative and positive values show how the output changes when moving along this dimension.</small></p>
            `;
            
            container.appendChild(explanation);
        }
        
        // Helper function: Convert hex color to RGB object
        function hexToRgb(hex) {
            // Remove # if present
            hex = hex.replace('#', '');
            
            // Parse RGB components
            const r = parseInt(hex.substring(0, 2), 16);
            const g = parseInt(hex.substring(2, 4), 16);
            const b = parseInt(hex.substring(4, 6), 16);
            
            return { r, g, b };
        }
        
        // Load data on page initialization
        window.addEventListener('DOMContentLoaded', async () => {
            preGeneratedData = await loadPreGeneratedData();
            
            // Initialize the rest of the page
            initSliders();
            initializeLatentSpace();
            
            // Open first collapsible in each tab
            document.querySelectorAll('.tab-content').forEach(tab => {
                const firstCollapsible = tab.querySelector('.collapsible');
                if (firstCollapsible) {
                    firstCollapsible.click();
                }
            });
        });
    </script>
</body>
</html>
